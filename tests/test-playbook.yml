---
# Desktop tests, from root folder run: ./testme.sh.

- name: Debian desktop configuration.
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
  - name: Test with null.
    debug:
      msg:
        - '__________________________________________________________________'
        - 'Testing with null.'
        - '__________________________________________________________________'

  - name: Run desktop configuration with null.
    import_role:
      name: constrict0r.desktop
    vars:
      users: null
      password: null

  - name: Test with none.
    debug:
      msg:
        - '__________________________________________________________________'
        - 'Testing with none.'
        - '__________________________________________________________________'

  - name: Run desktop configuration with none.
    import_role:
      name: constrict0r.desktop
    vars:
      users:
      password:

  - name: Test with undefined.
    debug:
      msg:
        - '___________________________________________________________________'
        - 'Testing with undefined.'
        - '___________________________________________________________________'

  - name: Run desktop configuration with undefined.
    import_role:
      name: constrict0r.desktop
    vars:
      users: "{{ undefined_variable }}"
      password: "{{ undefined_variable }}"

  - name: Test with empty.
    debug:
      msg:
        - '__________________________________________________________________'
        - 'Testing with empty.'
        - '__________________________________________________________________'

  - name: Run desktop configuration with empty.
    import_role:
      name: constrict0r.desktop
    vars:
      users: ''
      password: ''

  - name: Test with non-empty.
    debug:
      msg:
        - '__________________________________________________________________'
        - 'Testing with NON-empty.'
        - '__________________________________________________________________'

  - name: Run desktop configuration with non-empty.
    import_role:
      name: constrict0r.desktop
    vars:
      upgrade: false
      users: [mary, jhon]
      password: 4321

  - name: Verify curl package installed.
    file:
      path: /usr/bin/curl

  - name: Verify audacity package installed.
    file:
      path: /usr/bin/audacity

  - name: Verify /home/mary directory status.
    stat:
      path: /home/mary
    register: stat_result
    failed_when:
      - stat_result.stat.isdir is not defined or not stat_result.stat.isdir

  - name: Verify /home/mary/.vimrc
    stat:
      path: /home/mary/.vimrc
    register: stat_result
    failed_when:
      - stat_result.stat.isreg is not defined or not stat_result.stat.isreg
